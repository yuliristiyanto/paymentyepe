<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WiFi Payment System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        .sidebar {
            min-height: 100vh;
        }
        .main-content {
            padding: 20px;
        }
        .dashboard-card {
            transition: transform 0.3s;
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
        }
        @media (max-width: 768px) {
            .sidebar {
                min-height: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 d-md-block bg-dark sidebar collapse" id="sidebarMenu">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <h4 class="text-white">WiFi Payment</h4>
                    </div>
                    <ul class="nav flex-column" id="menuItems">
                        <!-- Menu items will be loaded based on user role -->
                    </ul>
                </div>
            </div>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
                <nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
                    <div class="container-fluid">
                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="d-flex align-items-center">
                            <span id="currentUser" class="me-3"></span>
                            <button class="btn btn-outline-danger btn-sm" id="logoutBtn">Logout</button>
                        </div>
                    </div>
                </nav>

                <div id="contentArea">
                    <!-- Content will be loaded here based on menu selection -->
                    <div class="text-center mt-5">
                        <h3>Selamat datang di Sistem Pembayaran WiFi</h3>
                        <p class="text-muted">Silakan login untuk melanjutkan</p>
                        <div id="loginForm">
                            <div class="row justify-content-center">
                                <div class="col-md-6 col-lg-4">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title text-center">Login</h5>
                                            <form id="loginFormElement">
                                                <div class="mb-3">
                                                    <label for="username" class="form-label">Username</label>
                                                    <input type="text" class="form-control" id="username" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="password" class="form-label">Password</label>
                                                    <input type="password" class="form-control" id="password" required>
                                                </div>
                                                <button type="submit" class="btn btn-primary w-100">Login</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal untuk berbagai aksi -->
    <div class="modal fade" id="actionModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Modal title</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="modalBody">
                    ...
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                    <button type="button" class="btn btn-primary" id="modalConfirmBtn">Simpan</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/locale/id.min.js"></script>
    <script>
        // Inisialisasi moment.js dengan locale Indonesia
        moment.locale('id');
        
        // Variabel global untuk menyimpan data user
        let currentUser = null;
        
        // Fungsi untuk menampilkan konten berdasarkan role
        function loadContentBasedOnRole() {
            const menuItems = document.getElementById('menuItems');
            menuItems.innerHTML = '';
            
            if (!currentUser) {
                document.getElementById('loginForm').style.display = 'block';
                document.getElementById('currentUser').textContent = '';
                return;
            }
            
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('currentUser').textContent = `Halo, ${currentUser.username} (${currentUser.role})`;
            
            // Menu untuk semua role
            const dashboardItem = document.createElement('li');
            dashboardItem.className = 'nav-item';
            dashboardItem.innerHTML = `
                <a class="nav-link text-white active" href="#" data-content="dashboard">
                    <i class="bi bi-speedometer2 me-2"></i>Dashboard
                </a>
            `;
            menuItems.appendChild(dashboardItem);
            
            // Menu khusus Admin
            if (currentUser.role === 'admin') {
                const userManagementItem = document.createElement('li');
                userManagementItem.className = 'nav-item';
                userManagementItem.innerHTML = `
                    <a class="nav-link text-white" href="#" data-content="userManagement">
                        <i class="bi bi-people me-2"></i>Manajemen User
                    </a>
                `;
                menuItems.appendChild(userManagementItem);
                
                const pelangganItem = document.createElement('li');
                pelangganItem.className = 'nav-item';
                pelangganItem.innerHTML = `
                    <a class="nav-link text-white" href="#" data-content="pelangganManagement">
                        <i class="bi bi-person-lines-fill me-2"></i>Manajemen Pelanggan
                    </a>
                `;
                menuItems.appendChild(pelangganItem);
                
                const paketItem = document.createElement('li');
                paketItem.className = 'nav-item';
                paketItem.innerHTML = `
                    <a class="nav-link text-white" href="#" data-content="paketManagement">
                        <i class="bi bi-wifi me-2"></i>Manajemen Paket
                    </a>
                `;
                menuItems.appendChild(paketItem);
            }
            
            // Menu khusus Kasir
            if (currentUser.role === 'kasir' || currentUser.role === 'admin') {
                const pembayaranItem = document.createElement('li');
                pembayaranItem.className = 'nav-item';
                pembayaranItem.innerHTML = `
                    <a class="nav-link text-white" href="#" data-content="pembayaranManagement">
                        <i class="bi bi-cash-coin me-2"></i>Pembayaran
                    </a>
                `;
                menuItems.appendChild(pembayaranItem);
                
                const laporanItem = document.createElement('li');
                laporanItem.className = 'nav-item';
                laporanItem.innerHTML = `
                    <a class="nav-link text-white" href="#" data-content="laporan">
                        <i class="bi bi-file-earmark-text me-2"></i>Laporan
                    </a>
                `;
                menuItems.appendChild(laporanItem);
            }
            
            // Menu khusus Pelanggan
            if (currentUser.role === 'pelanggan') {
                const statusPembayaranItem = document.createElement('li');
                statusPembayaranItem.className = 'nav-item';
                statusPembayaranItem.innerHTML = `
                    <a class="nav-link text-white" href="#" data-content="statusPembayaran">
                        <i class="bi bi-calendar-check me-2"></i>Status Pembayaran
                    </a>
                `;
                menuItems.appendChild(statusPembayaranItem);
                
                const bayarItem = document.createElement('li');
                bayarItem.className = 'nav-item';
                bayarItem.innerHTML = `
                    <a class="nav-link text-white" href="#" data-content="bayar">
                        <i class="bi bi-credit-card me-2"></i>Bayar Tagihan
                    </a>
                `;
                menuItems.appendChild(bayarItem);
            }
            
            // Tambahkan event listener untuk menu items
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const content = this.getAttribute('data-content');
                    loadContent(content);
                    
                    // Update active class
                    document.querySelectorAll('.nav-link').forEach(item => {
                        item.classList.remove('active');
                    });
                    this.classList.add('active');
                });
            });
            
            // Load dashboard secara default
            loadContent('dashboard');
        }
        
        // Fungsi untuk memuat konten
        function loadContent(content) {
            const contentArea = document.getElementById('contentArea');
            
            switch(content) {
                case 'dashboard':
                    loadDashboard(contentArea);
                    break;
                case 'userManagement':
                    loadUserManagement(contentArea);
                    break;
                case 'pelangganManagement':
                    loadPelangganManagement(contentArea);
                    break;
                case 'paketManagement':
                    loadPaketManagement(contentArea);
                    break;
                case 'pembayaranManagement':
                    loadPembayaranManagement(contentArea);
                    break;
                case 'laporan':
                    loadLaporan(contentArea);
                    break;
                case 'statusPembayaran':
                    loadStatusPembayaran(contentArea);
                    break;
                case 'bayar':
                    loadBayar(contentArea);
                    break;
                default:
                    contentArea.innerHTML = '<p>Konten tidak ditemukan</p>';
            }
        }
        
        // Fungsi untuk memuat dashboard
        function loadDashboard(contentArea) {
            let dashboardHTML = `
                <h4 class="mb-4">Dashboard</h4>
                <div class="row">
            `;
            
            if (currentUser.role === 'admin') {
                dashboardHTML += `
                    <div class="col-md-4 mb-4">
                        <div class="card text-white bg-primary dashboard-card">
                            <div class="card-body">
                                <h5 class="card-title">Total Pelanggan</h5>
                                <h2 class="card-text" id="totalPelanggan">0</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-4">
                        <div class="card text-white bg-success dashboard-card">
                            <div class="card-body">
                                <h5 class="card-title">Pembayaran Bulan Ini</h5>
                                <h2 class="card-text" id="pembayaranBulanIni">0</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-4">
                        <div class="card text-white bg-warning dashboard-card">
                            <div class="card-body">
                                <h5 class="card-title">Belum Bayar Bulan Ini</h5>
                                <h2 class="card-text" id="belumBayarBulanIni">0</h2>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentUser.role === 'kasir') {
                dashboardHTML += `
                    <div class="col-md-6 mb-4">
                        <div class="card text-white bg-success dashboard-card">
                            <div class="card-body">
                                <h5 class="card-title">Pembayaran Hari Ini</h5>
                                <h2 class="card-text" id="pembayaranHariIni">0</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card text-white bg-warning dashboard-card">
                            <div class="card-body">
                                <h5 class="card-title">Pending Konfirmasi</h5>
                                <h2 class="card-text" id="pendingKonfirmasi">0</h2>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentUser.role === 'pelanggan') {
                dashboardHTML += `
                    <div class="col-md-6 mb-4">
                        <div class="card text-white bg-success dashboard-card">
                            <div class="card-body">
                                <h5 class="card-title">Sudah Bayar</h5>
                                <h2 class="card-text" id="sudahBayar">0</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card text-white bg-danger dashboard-card">
                            <div class="card-body">
                                <h5 class="card-title">Belum Bayar</h5>
                                <h2 class="card-text" id="belumBayar">0</h2>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            dashboardHTML += `</div>`;
            
            if (currentUser.role === 'admin' || currentUser.role === 'kasir') {
                dashboardHTML += `
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5>Pembayaran Terakhir</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>ID Pelanggan</th>
                                            <th>Nama</th>
                                            <th>Bulan</th>
                                            <th>Tanggal Bayar</th>
                                            <th>Jumlah</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recentPayments">
                                        <!-- Data akan diisi oleh JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            contentArea.innerHTML = dashboardHTML;
            loadDashboardData();
        }
        
        // Fungsi untuk memuat data dashboard
        function loadDashboardData() {
            // Ini adalah contoh, dalam implementasi nyata Anda akan memanggil Google Apps Script
            // Untuk mendapatkan data dari spreadsheet
            
            // Simulasi data
            if (currentUser.role === 'admin') {
                document.getElementById('totalPelanggan').textContent = '125';
                document.getElementById('pembayaranBulanIni').textContent = 'Rp 12.450.000';
                document.getElementById('belumBayarBulanIni').textContent = '15';
                
                const recentPayments = [
                    {id: 'PLG-001', nama: 'Budi Santoso', bulan: 'Juli 2023', tglBayar: '2023-07-15', jumlah: '350.000', status: 'Lunas'},
                    {id: 'PLG-005', nama: 'Ani Wijaya', bulan: 'Juli 2023', tglBayar: '2023-07-14', jumlah: '500.000', status: 'Lunas'},
                    {id: 'PLG-012', nama: 'Citra Dewi', bulan: 'Juli 2023', tglBayar: '2023-07-14', jumlah: '350.000', status: 'Lunas'},
                ];
                
                const tbody = document.getElementById('recentPayments');
                tbody.innerHTML = '';
                recentPayments.forEach(payment => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${payment.id}</td>
                        <td>${payment.nama}</td>
                        <td>${payment.bulan}</td>
                        <td>${payment.tglBayar}</td>
                        <td>${payment.jumlah}</td>
                        <td><span class="badge bg-success">${payment.status}</span></td>
                    `;
                    tbody.appendChild(tr);
                });
            } else if (currentUser.role === 'kasir') {
                document.getElementById('pembayaranHariIni').textContent = 'Rp 1.200.000';
                document.getElementById('pendingKonfirmasi').textContent = '3';
            } else if (currentUser.role === 'pelanggan') {
                document.getElementById('sudahBayar').textContent = '10';
                document.getElementById('belumBayar').textContent = '2';
            }
        }
        
        // Fungsi untuk memuat manajemen user (admin only)
        function loadUserManagement(contentArea) {
            contentArea.innerHTML = `
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4>Manajemen User</h4>
                    <button class="btn btn-primary" id="tambahUserBtn">
                        <i class="bi bi-plus-circle"></i> Tambah User
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Username</th>
                                        <th>Role</th>
                                        <th>ID Pelanggan</th>
                                        <th>Tanggal Dibuat</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="userTableBody">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            // Contoh data user
            const users = [
                {username: 'admin', role: 'admin', idPelanggan: '-', tglDibuat: '2023-01-01', status: 'aktif'},
                {username: 'kasir1', role: 'kasir', idPelanggan: '-', tglDibuat: '2023-01-15', status: 'aktif'},
                {username: 'pelanggan1', role: 'pelanggan', idPelanggan: 'PLG-001', tglDibuat: '2023-02-01', status: 'aktif'},
            ];
            
            const tbody = document.getElementById('userTableBody');
            tbody.innerHTML = '';
            users.forEach(user => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.role}</td>
                    <td>${user.idPelanggan}</td>
                    <td>${user.tglDibuat}</td>
                    <td><span class="badge ${user.status === 'aktif' ? 'bg-success' : 'bg-danger'}">${user.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-warning edit-user" data-username="${user.username}">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-danger delete-user" data-username="${user.username}">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            // Event listener untuk tombol tambah user
            document.getElementById('tambahUserBtn').addEventListener('click', () => {
                showUserForm();
            });
            
            // Event listener untuk tombol edit dan delete
            document.querySelectorAll('.edit-user').forEach(btn => {
                btn.addEventListener('click', function() {
                    const username = this.getAttribute('data-username');
                    editUser(username);
                });
            });
            
            document.querySelectorAll('.delete-user').forEach(btn => {
                btn.addEventListener('click', function() {
                    const username = this.getAttribute('data-username');
                    deleteUser(username);
                });
            });
        }
        
        // Fungsi untuk menampilkan form user
        function showUserForm(user = null) {
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            if (user) {
                modalTitle.textContent = 'Edit User';
            } else {
                modalTitle.textContent = 'Tambah User Baru';
            }
            
            modalBody.innerHTML = `
                <form id="userForm">
                    <div class="mb-3">
                        <label for="formUsername" class="form-label">Username</label>
                        <input type="text" class="form-control" id="formUsername" value="${user ? user.username : ''}" ${user ? 'readonly' : ''} required>
                    </div>
                    <div class="mb-3">
                        <label for="formPassword" class="form-label">Password</label>
                        <input type="password" class="form-control" id="formPassword" ${user ? 'placeholder="Kosongkan jika tidak ingin mengubah"' : 'required'}>
                    </div>
                    <div class="mb-3">
                        <label for="formRole" class="form-label">Role</label>
                        <select class="form-select" id="formRole" required>
                            <option value="admin" ${user && user.role === 'admin' ? 'selected' : ''}>Admin</option>
                            <option value="kasir" ${user && user.role === 'kasir' ? 'selected' : ''}>Kasir</option>
                            <option value="pelanggan" ${user && user.role === 'pelanggan' ? 'selected' : ''}>Pelanggan</option>
                        </select>
                    </div>
                    <div class="mb-3" id="idPelangganContainer" style="display: none;">
                        <label for="formIdPelanggan" class="form-label">ID Pelanggan</label>
                        <input type="text" class="form-control" id="formIdPelanggan" value="${user ? user.idPelanggan : ''}">
                    </div>
                    <div class="mb-3">
                        <label for="formStatus" class="form-label">Status</label>
                        <select class="form-select" id="formStatus" required>
                            <option value="aktif" ${user && user.status === 'aktif' ? 'selected' : ''}>Aktif</option>
                            <option value="nonaktif" ${user && user.status === 'nonaktif' ? 'selected' : ''}>Nonaktif</option>
                        </select>
                    </div>
                </form>
            `;
            
            // Tampilkan/menyembunyikan field ID Pelanggan berdasarkan role
            const roleSelect = document.getElementById('formRole');
            const idPelangganContainer = document.getElementById('idPelangganContainer');
            
            roleSelect.addEventListener('change', function() {
                if (this.value === 'pelanggan') {
                    idPelangganContainer.style.display = 'block';
                } else {
                    idPelangganContainer.style.display = 'none';
                }
            });
            
            // Trigger change event untuk mengecek nilai awal
            roleSelect.dispatchEvent(new Event('change'));
            
            // Konfigurasi tombol konfirmasi
            const modalConfirmBtn = document.getElementById('modalConfirmBtn');
            modalConfirmBtn.textContent = user ? 'Update' : 'Simpan';
            
            const modal = new bootstrap.Modal(document.getElementById('actionModal'));
            modal.show();
            
            // Event listener untuk tombol simpan
            modalConfirmBtn.onclick = function() {
                saveUser(user);
                modal.hide();
            };
        }
        
        // Fungsi untuk menyimpan user
        function saveUser(user) {
            // Implementasi penyimpanan ke Google Spreadsheet
            alert(`User ${user ? 'diupdate' : 'disimpan'}!`);
            loadContent('userManagement');
        }
        
        // Fungsi untuk mengedit user
        function editUser(username) {
            // Dalam implementasi nyata, Anda akan mengambil data user dari spreadsheet
            const user = {
                username: username,
                role: 'kasir',
                idPelanggan: '-',
                status: 'aktif'
            };
            showUserForm(user);
        }
        
        // Fungsi untuk menghapus user
        function deleteUser(username) {
            if (confirm(`Apakah Anda yakin ingin menghapus user ${username}?`)) {
                // Implementasi penghapusan dari Google Spreadsheet
                alert(`User ${username} dihapus!`);
                loadContent('userManagement');
            }
        }
        
        // Fungsi untuk memuat manajemen pelanggan (admin only)
        function loadPelangganManagement(contentArea) {
            contentArea.innerHTML = `
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4>Manajemen Pelanggan</h4>
                    <button class="btn btn-primary" id="tambahPelangganBtn">
                        <i class="bi bi-plus-circle"></i> Tambah Pelanggan
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID Pelanggan</th>
                                        <th>Nama</th>
                                        <th>Alamat</th>
                                        <th>No. HP</th>
                                        <th>Tanggal Pasang</th>
                                        <th>Paket</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="pelangganTableBody">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            // Contoh data pelanggan
            const pelanggans = [
                {id: 'PLG-001', nama: 'Budi Santoso', alamat: 'Jl. Merdeka No. 10', noHp: '08123456789', tglPasang: '2023-01-15', paket: 'Paket 10 Mbps', status: 'aktif'},
                {id: 'PLG-002', nama: 'Ani Wijaya', alamat: 'Jl. Sudirman No. 25', noHp: '08234567890', tglPasang: '2023-02-01', paket: 'Paket 20 Mbps', status: 'aktif'},
                {id: 'PLG-003', nama: 'Citra Dewi', alamat: 'Jl. Gatot Subroto No. 5', noHp: '08345678901', tglPasang: '2023-02-10', paket: 'Paket 10 Mbps', status: 'nonaktif'},
            ];
            
            const tbody = document.getElementById('pelangganTableBody');
            tbody.innerHTML = '';
            pelanggans.forEach(pelanggan => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${pelanggan.id}</td>
                    <td>${pelanggan.nama}</td>
                    <td>${pelanggan.alamat}</td>
                    <td>${pelanggan.noHp}</td>
                    <td>${pelanggan.tglPasang}</td>
                    <td>${pelanggan.paket}</td>
                    <td><span class="badge ${pelanggan.status === 'aktif' ? 'bg-success' : 'bg-danger'}">${pelanggan.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-warning edit-pelanggan" data-id="${pelanggan.id}">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-danger delete-pelanggan" data-id="${pelanggan.id}">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            // Event listener untuk tombol tambah pelanggan
            document.getElementById('tambahPelangganBtn').addEventListener('click', () => {
                showPelangganForm();
            });
            
            // Event listener untuk tombol edit dan delete
            document.querySelectorAll('.edit-pelanggan').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    editPelanggan(id);
                });
            });
            
            document.querySelectorAll('.delete-pelanggan').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    deletePelanggan(id);
                });
            });
        }
        
        // Fungsi untuk menampilkan form pelanggan
        function showPelangganForm(pelanggan = null) {
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            if (pelanggan) {
                modalTitle.textContent = 'Edit Pelanggan';
            } else {
                modalTitle.textContent = 'Tambah Pelanggan Baru';
            }
            
            modalBody.innerHTML = `
                <form id="pelangganForm">
                    <div class="mb-3">
                        <label for="formPelangganId" class="form-label">ID Pelanggan</label>
                        <input type="text" class="form-control" id="formPelangganId" value="${pelanggan ? pelanggan.id : ''}" ${pelanggan ? 'readonly' : ''} required>
                    </div>
                    <div class="mb-3">
                        <label for="formPelangganNama" class="form-label">Nama Pelanggan</label>
                        <input type="text" class="form-control" id="formPelangganNama" value="${pelanggan ? pelanggan.nama : ''}" required>
                    </div>
                    <div class="mb-3">
                        <label for="formPelangganAlamat" class="form-label">Alamat</label>
                        <textarea class="form-control" id="formPelangganAlamat" rows="2" required>${pelanggan ? pelanggan.alamat : ''}</textarea>
                    </div>
                    <div class="mb-3">
                        <label for="formPelangganNoHp" class="form-label">No. HP</label>
                        <input type="text" class="form-control" id="formPelangganNoHp" value="${pelanggan ? pelanggan.noHp : ''}" required>
                    </div>
                    <div class="mb-3">
                        <label for="formPelangganTglPasang" class="form-label">Tanggal Pasang</label>
                        <input type="date" class="form-control" id="formPelangganTglPasang" value="${pelanggan ? pelanggan.tglPasang : ''}" required>
                    </div>
                    <div class="mb-3">
                        <label for="formPelangganPaket" class="form-label">Paket Berlangganan</label>
                        <select class="form-select" id="formPelangganPaket" required>
                            <option value="Paket 10 Mbps" ${pelanggan && pelanggan.paket === 'Paket 10 Mbps' ? 'selected' : ''}>Paket 10 Mbps - Rp 350.000/bulan</option>
                            <option value="Paket 20 Mbps" ${pelanggan && pelanggan.paket === 'Paket 20 Mbps' ? 'selected' : ''}>Paket 20 Mbps - Rp 500.000/bulan</option>
                            <option value="Paket 50 Mbps" ${pelanggan && pelanggan.paket === 'Paket 50 Mbps' ? 'selected' : ''}>Paket 50 Mbps - Rp 800.000/bulan</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="formPelangganStatus" class="form-label">Status</label>
                        <select class="form-select" id="formPelangganStatus" required>
                            <option value="aktif" ${pelanggan && pelanggan.status === 'aktif' ? 'selected' : ''}>Aktif</option>
                            <option value="nonaktif" ${pelanggan && pelanggan.status === 'nonaktif' ? 'selected' : ''}>Nonaktif</option>
                        </select>
                    </div>
                </form>
            `;
            
            // Konfigurasi tombol konfirmasi
            const modalConfirmBtn = document.getElementById('modalConfirmBtn');
            modalConfirmBtn.textContent = pelanggan ? 'Update' : 'Simpan';
            
            const modal = new bootstrap.Modal(document.getElementById('actionModal'));
            modal.show();
            
            // Event listener untuk tombol simpan
            modalConfirmBtn.onclick = function() {
                savePelanggan(pelanggan);
                modal.hide();
            };
        }
        
        // Fungsi untuk menyimpan pelanggan
        function savePelanggan(pelanggan) {
            // Implementasi penyimpanan ke Google Spreadsheet
            alert(`Pelanggan ${pelanggan ? 'diupdate' : 'disimpan'}!`);
            loadContent('pelangganManagement');
        }
        
        // Fungsi untuk mengedit pelanggan
        function editPelanggan(id) {
            // Dalam implementasi nyata, Anda akan mengambil data pelanggan dari spreadsheet
            const pelanggan = {
                id: id,
                nama: 'Budi Santoso',
                alamat: 'Jl. Merdeka No. 10',
                noHp: '08123456789',
                tglPasang: '2023-01-15',
                paket: 'Paket 10 Mbps',
                status: 'aktif'
            };
            showPelangganForm(pelanggan);
        }
        
        // Fungsi untuk menghapus pelanggan
        function deletePelanggan(id) {
            if (confirm(`Apakah Anda yakin ingin menghapus pelanggan ${id}?`)) {
                // Implementasi penghapusan dari Google Spreadsheet
                alert(`Pelanggan ${id} dihapus!`);
                loadContent('pelangganManagement');
            }
        }
        
        // Fungsi untuk memuat manajemen paket (admin only)
        function loadPaketManagement(contentArea) {
            contentArea.innerHTML = `
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4>Manajemen Paket</h4>
                    <button class="btn btn-primary" id="tambahPaketBtn">
                        <i class="bi bi-plus-circle"></i> Tambah Paket
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Nama Paket</th>
                                        <th>Kecepatan</th>
                                        <th>Harga Bulanan</th>
                                        <th>Deskripsi</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="paketTableBody">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            // Contoh data paket
            const pakets = [
                {nama: 'Paket 10 Mbps', kecepatan: '10 Mbps', harga: '350000', deskripsi: 'Paket ekonomis untuk penggunaan ringan'},
                {nama: 'Paket 20 Mbps', kecepatan: '20 Mbps', harga: '500000', deskripsi: 'Paket standar untuk keluarga'},
                {nama: 'Paket 50 Mbps', kecepatan: '50 Mbps', harga: '800000', deskripsi: 'Paket premium untuk kebutuhan tinggi'},
            ];
            
            const tbody = document.getElementById('paketTableBody');
            tbody.innerHTML = '';
            pakets.forEach(paket => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${paket.nama}</td>
                    <td>${paket.kecepatan}</td>
                    <td>Rp ${formatNumber(paket.harga)}</td>
                    <td>${paket.deskripsi}</td>
                    <td>
                        <button class="btn btn-sm btn-warning edit-paket" data-nama="${paket.nama}">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-danger delete-paket" data-nama="${paket.nama}">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            // Event listener untuk tombol tambah paket
            document.getElementById('tambahPaketBtn').addEventListener('click', () => {
                showPaketForm();
            });
            
            // Event listener untuk tombol edit dan delete
            document.querySelectorAll('.edit-paket').forEach(btn => {
                btn.addEventListener('click', function() {
                    const nama = this.getAttribute('data-nama');
                    editPaket(nama);
                });
            });
            
            document.querySelectorAll('.delete-paket').forEach(btn => {
                btn.addEventListener('click', function() {
                    const nama = this.getAttribute('data-nama');
                    deletePaket(nama);
                });
            });
        }
        
        // Fungsi untuk menampilkan form paket
        function showPaketForm(paket = null) {
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            if (paket) {
                modalTitle.textContent = 'Edit Paket';
            } else {
                modalTitle.textContent = 'Tambah Paket Baru';
            }
            
            modalBody.innerHTML = `
                <form id="paketForm">
                    <div class="mb-3">
                        <label for="formPaketNama" class="form-label">Nama Paket</label>
                        <input type="text" class="form-control" id="formPaketNama" value="${paket ? paket.nama : ''}" required>
                    </div>
                    <div class="mb-3">
                        <label for="formPaketKecepatan" class="form-label">Kecepatan</label>
                        <input type="text" class="form-control" id="formPaketKecepatan" value="${paket ? paket.kecepatan : ''}" required>
                    </div>
                    <div class="mb-3">
                        <label for="formPaketHarga" class="form-label">Harga Bulanan</label>
                        <input type="number" class="form-control" id="formPaketHarga" value="${paket ? paket.harga : ''}" required>
                    </div>
                    <div class="mb-3">
                        <label for="formPaketDeskripsi" class="form-label">Deskripsi</label>
                        <textarea class="form-control" id="formPaketDeskripsi" rows="3">${paket ? paket.deskripsi : ''}</textarea>
                    </div>
                </form>
            `;
            
            // Konfigurasi tombol konfirmasi
            const modalConfirmBtn = document.getElementById('modalConfirmBtn');
            modalConfirmBtn.textContent = paket ? 'Update' : 'Simpan';
            
            const modal = new bootstrap.Modal(document.getElementById('actionModal'));
            modal.show();
            
            // Event listener untuk tombol simpan
            modalConfirmBtn.onclick = function() {
                savePaket(paket);
                modal.hide();
            };
        }
        
        // Fungsi untuk menyimpan paket
        function savePaket(paket) {
            // Implementasi penyimpanan ke Google Spreadsheet
            alert(`Paket ${paket ? 'diupdate' : 'disimpan'}!`);
            loadContent('paketManagement');
        }
        
        // Fungsi untuk mengedit paket
        function editPaket(nama) {
            // Dalam implementasi nyata, Anda akan mengambil data paket dari spreadsheet
            const paket = {
                nama: nama,
                kecepatan: '10 Mbps',
                harga: '350000',
                deskripsi: 'Paket ekonomis untuk penggunaan ringan'
            };
            showPaketForm(paket);
        }
        
        // Fungsi untuk menghapus paket
        function deletePaket(nama) {
            if (confirm(`Apakah Anda yakin ingin menghapus paket ${nama}?`)) {
                // Implementasi penghapusan dari Google Spreadsheet
                alert(`Paket ${nama} dihapus!`);
                loadContent('paketManagement');
            }
        }
        
        // Fungsi untuk memuat manajemen pembayaran (admin dan kasir)
        function loadPembayaranManagement(contentArea) {
            contentArea.innerHTML = `
                <h4 class="mb-4">Manajemen Pembayaran</h4>
                
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="input-group">
                            <input type="text" class="form-control" id="searchPayment" placeholder="Cari ID Pelanggan atau Nama...">
                            <button class="btn btn-outline-secondary" type="button" id="searchPaymentBtn">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                    </div>
                    <div class="col-md-6 text-end">
                        <button class="btn btn-success" id="exportPaymentBtn">
                            <i class="bi bi-file-earmark-excel"></i> Export Excel
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID Pembayaran</th>
                                        <th>ID Pelanggan</th>
                                        <th>Nama Pelanggan</th>
                                        <th>Bulan/Tahun</th>
                                        <th>Tanggal Bayar</th>
                                        <th>Jumlah</th>
                                        <th>Bukti Transfer</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="paymentTableBody">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            // Contoh data pembayaran
            const payments = [
                {id: 'PAY-001', pelangganId: 'PLG-001', nama: 'Budi Santoso', bulan: '7', tahun: '2023', tglBayar: '2023-07-15', jumlah: '350000', bukti: 'bukti1.jpg', status: 'lunas'},
                {id: 'PAY-002', pelangganId: 'PLG-002', nama: 'Ani Wijaya', bulan: '7', tahun: '2023', tglBayar: '2023-07-14', jumlah: '500000', bukti: 'bukti2.jpg', status: 'lunas'},
                {id: 'PAY-003', pelangganId: 'PLG-003', nama: 'Citra Dewi', bulan: '7', tahun: '2023', tglBayar: '2023-07-16', jumlah: '350000', bukti: 'bukti3.jpg', status: 'pending'},
            ];
            
            const tbody = document.getElementById('paymentTableBody');
            tbody.innerHTML = '';
            payments.forEach(payment => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${payment.id}</td>
                    <td>${payment.pelangganId}</td>
                    <td>${payment.nama}</td>
                    <td>${getMonthName(payment.bulan)} ${payment.tahun}</td>
                    <td>${payment.tglBayar}</td>
                    <td>Rp ${formatNumber(payment.jumlah)}</td>
                    <td>
                        <a href="#" class="view-bukti" data-bukti="${payment.bukti}">Lihat</a>
                    </td>
                    <td>
                        <span class="badge ${payment.status === 'lunas' ? 'bg-success' : 'bg-warning'}">
                            ${payment.status === 'lunas' ? 'Lunas' : 'Pending'}
                        </span>
                    </td>
                    <td>
                        ${payment.status === 'pending' ? `
                        <button class="btn btn-sm btn-success confirm-payment" data-id="${payment.id}">
                            <i class="bi bi-check-circle"></i> Konfirmasi
                        </button>
                        ` : ''}
                        <button class="btn btn-sm btn-danger delete-payment" data-id="${payment.id}">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            // Event listener untuk tombol konfirmasi pembayaran
            document.querySelectorAll('.confirm-payment').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    confirmPayment(id);
                });
            });
            
            // Event listener untuk tombol hapus pembayaran
            document.querySelectorAll('.delete-payment').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    deletePayment(id);
                });
            });
            
            // Event listener untuk melihat bukti transfer
            document.querySelectorAll('.view-bukti').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const bukti = this.getAttribute('data-bukti');
                    viewBuktiTransfer(bukti);
                });
            });
            
            // Event listener untuk pencarian
            document.getElementById('searchPaymentBtn').addEventListener('click', function() {
                const searchTerm = document.getElementById('searchPayment').value.toLowerCase();
                filterPayments(searchTerm);
            });
            
            // Event listener untuk export excel
            document.getElementById('exportPaymentBtn').addEventListener('click', exportPayments);
        }
        
        // Fungsi untuk mengkonfirmasi pembayaran
        function confirmPayment(id) {
            if (confirm(`Apakah Anda yakin ingin mengkonfirmasi pembayaran ${id}?`)) {
                // Implementasi konfirmasi pembayaran di Google Spreadsheet
                alert(`Pembayaran ${id} telah dikonfirmasi!`);
                loadContent('pembayaranManagement');
            }
        }
        
        // Fungsi untuk menghapus pembayaran
        function deletePayment(id) {
            if (confirm(`Apakah Anda yakin ingin menghapus pembayaran ${id}?`)) {
                // Implementasi penghapusan pembayaran di Google Spreadsheet
                alert(`Pembayaran ${id} dihapus!`);
                loadContent('pembayaranManagement');
            }
        }
        
        // Fungsi untuk melihat bukti transfer
        function viewBuktiTransfer(bukti) {
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            modalTitle.textContent = 'Bukti Transfer';
            modalBody.innerHTML = `
                <div class="text-center">
                    <img src="${bukti}" class="img-fluid" alt="Bukti Transfer">
                </div>
            `;
            
            // Konfigurasi tombol konfirmasi
            const modalConfirmBtn = document.getElementById('modalConfirmBtn');
            modalConfirmBtn.style.display = 'none';
            
            const modal = new bootstrap.Modal(document.getElementById('actionModal'));
            modal.show();
        }
        
        // Fungsi untuk memfilter pembayaran
        function filterPayments(searchTerm) {
            // Implementasi pencarian
            alert(`Mencari: ${searchTerm}`);
        }
        
        // Fungsi untuk export data pembayaran
        function exportPayments() {
            // Implementasi export ke Excel
            alert('Data pembayaran diexport ke Excel!');
        }
        
        // Fungsi untuk memuat laporan (admin dan kasir)
        function loadLaporan(contentArea) {
            contentArea.innerHTML = `
                <h4 class="mb-4">Laporan Pembayaran</h4>
                
                <div class="row mb-4">
                    <div class="col-md-4">
                        <label for="reportType" class="form-label">Jenis Laporan</label>
                        <select class="form-select" id="reportType">
                            <option value="bulanan">Bulanan</option>
                            <option value="tahunan">Tahunan</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    <div class="col-md-4" id="monthYearContainer">
                        <div class="row">
                            <div class="col-md-6">
                                <label for="reportMonth" class="form-label">Bulan</label>
                                <select class="form-select" id="reportMonth">
                                    ${Array.from({length: 12}, (_, i) => `
                                        <option value="${i+1}" ${i+1 === new Date().getMonth()+1 ? 'selected' : ''}>
                                            ${getMonthName(i+1)}
                                        </option>
                                    `).join('')}
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="reportYear" class="form-label">Tahun</label>
                                <select class="form-select" id="reportYear">
                                    ${Array.from({length: 5}, (_, i) => {
                                        const year = new Date().getFullYear() - i;
                                        return `<option value="${year}" ${i === 0 ? 'selected' : ''}>${year}</option>`;
                                    }).join('')}
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4" id="dateRangeContainer" style="display: none;">
                        <div class="row">
                            <div class="col-md-6">
                                <label for="startDate" class="form-label">Dari Tanggal</label>
                                <input type="date" class="form-control" id="startDate">
                            </div>
                            <div class="col-md-6">
                                <label for="endDate" class="form-label">Sampai Tanggal</label>
                                <input type="date" class="form-control" id="endDate">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <button class="btn btn-primary" id="generateReportBtn">
                        <i class="bi bi-file-earmark-text"></i> Generate Laporan
                    </button>
                    <button class="btn btn-success ms-2" id="printReportBtn" disabled>
                        <i class="bi bi-printer"></i> Cetak Laporan
                    </button>
                    <button class="btn btn-success ms-2" id="exportReportBtn" disabled>
                        <i class="bi bi-file-earmark-excel"></i> Export Excel
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div id="reportResult">
                            <p class="text-muted text-center">Silakan generate laporan untuk melihat data</p>
                        </div>
                    </div>
                </div>
            `;
            
            // Event listener untuk perubahan jenis laporan
            document.getElementById('reportType').addEventListener('change', function() {
                const type = this.value;
                const monthYearContainer = document.getElementById('monthYearContainer');
                const dateRangeContainer = document.getElementById('dateRangeContainer');
                
                if (type === 'custom') {
                    monthYearContainer.style.display = 'none';
                    dateRangeContainer.style.display = 'block';
                } else {
                    monthYearContainer.style.display = 'block';
                    dateRangeContainer.style.display = 'none';
                }
            });
            
            // Event listener untuk tombol generate laporan
            document.getElementById('generateReportBtn').addEventListener('click', generateReport);
            
            // Event listener untuk tombol cetak laporan
            document.getElementById('printReportBtn').addEventListener('click', printReport);
            
            // Event listener untuk tombol export laporan
            document.getElementById('exportReportBtn').addEventListener('click', exportReport);
        }
        
        // Fungsi untuk generate laporan
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            let period = '';
            
            if (reportType === 'bulanan') {
                const month = document.getElementById('reportMonth').value;
                const year = document.getElementById('reportYear').value;
                period = `Bulan ${getMonthName(month)} ${year}`;
            } else if (reportType === 'tahunan') {
                const year = document.getElementById('reportYear').value;
                period = `Tahun ${year}`;
            } else {
                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;
                period = `Periode ${startDate} sampai ${endDate}`;
            }
            
            // Contoh data laporan
            const reportData = [
                {id: 'PLG-001', nama: 'Budi Santoso', bulan: 'Juli 2023', tglBayar: '2023-07-15', jumlah: '350000', status: 'Lunas'},
                {id: 'PLG-002', nama: 'Ani Wijaya', bulan: 'Juli 2023', tglBayar: '2023-07-14', jumlah: '500000', status: 'Lunas'},
                {id: 'PLG-003', nama: 'Citra Dewi', bulan: 'Juli 2023', tglBayar: '2023-07-16', jumlah: '350000', status: 'Pending'},
            ];
            
            const total = reportData.reduce((sum, item) => sum + parseInt(item.jumlah), 0);
            
            const reportResult = document.getElementById('reportResult');
            reportResult.innerHTML = `
                <h5 class="text-center mb-4">Laporan Pembayaran WiFi ${period}</h5>
                
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>ID Pelanggan</th>
                                <th>Nama Pelanggan</th>
                                <th>Periode</th>
                                <th>Tanggal Bayar</th>
                                <th>Jumlah</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${reportData.map(item => `
                                <tr>
                                    <td>${item.id}</td>
                                    <td>${item.nama}</td>
                                    <td>${item.bulan}</td>
                                    <td>${item.tglBayar}</td>
                                    <td>Rp ${formatNumber(item.jumlah)}</td>
                                    <td><span class="badge ${item.status === 'Lunas' ? 'bg-success' : 'bg-warning'}">${item.status}</span></td>
                                </tr>
                            `).join('')}
                        </tbody>
                        <tfoot>
                            <tr>
                                <th colspan="4" class="text-end">Total:</th>
                                <th colspan="2">Rp ${formatNumber(total)}</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            `;
            
            // Aktifkan tombol cetak dan export
            document.getElementById('printReportBtn').disabled = false;
            document.getElementById('exportReportBtn').disabled = false;
        }
        
        // Fungsi untuk mencetak laporan
        function printReport() {
            alert('Laporan dicetak!');
        }
        
        // Fungsi untuk export laporan
        function exportReport() {
            alert('Laporan diexport ke Excel!');
        }
        
        // Fungsi untuk memuat status pembayaran (pelanggan only)
        function loadStatusPembayaran(contentArea) {
            contentArea.innerHTML = `
                <h4 class="mb-4">Status Pembayaran Saya</h4>
                
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>Informasi Pelanggan</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>ID Pelanggan:</strong> <span id="customerId">PLG-001</span></p>
                                <p><strong>Nama:</strong> <span id="customerName">Budi Santoso</span></p>
                                <p><strong>Alamat:</strong> <span id="customerAddress">Jl. Merdeka No. 10</span></p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Paket:</strong> <span id="customerPackage">Paket 10 Mbps</span></p>
                                <p><strong>Harga Bulanan:</strong> <span id="customerPrice">Rp 350.000</span></p>
                                <p><strong>Tanggal Pasang:</strong> <span id="customerInstallDate">15 Januari 2023</span></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h5>Riwayat Pembayaran</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Bulan/Tahun</th>
                                        <th>Tanggal Bayar</th>
                                        <th>Jumlah</th>
                                        <th>Status</th>
                                        <th>Bukti Transfer</th>
                                    </tr>
                                </thead>
                                <tbody id="paymentHistoryBody">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            // Contoh data riwayat pembayaran
            const paymentHistory = [
                {bulan: '1', tahun: '2023', tglBayar: '2023-01-15', jumlah: '350000', status: 'lunas', bukti: 'bukti1.jpg'},
                {bulan: '2', tahun: '2023', tglBayar: '2023-02-15', jumlah: '350000', status: 'lunas', bukti: 'bukti2.jpg'},
                {bulan: '3', tahun: '2023', tglBayar: '2023-03-15', jumlah: '350000', status: 'lunas', bukti: 'bukti3.jpg'},
                {bulan: '4', tahun: '2023', tglBayar: '2023-04-15', jumlah: '350000', status: 'lunas', bukti: 'bukti4.jpg'},
                {bulan: '5', tahun: '2023', tglBayar: '2023-05-15', jumlah: '350000', status: 'lunas', bukti: 'bukti5.jpg'},
                {bulan: '6', tahun: '2023', tglBayar: '2023-06-15', jumlah: '350000', status: 'lunas', bukti: 'bukti6.jpg'},
                {bulan: '7', tahun: '2023', tglBayar: '2023-07-15', jumlah: '350000', status: 'lunas', bukti: 'bukti7.jpg'},
                {bulan: '8', tahun: '2023', tglBayar: '', jumlah: '350000', status: 'belum bayar', bukti: ''},
                {bulan: '9', tahun: '2023', tglBayar: '', jumlah: '350000', status: 'belum bayar', bukti: ''},
            ];
            
            const tbody = document.getElementById('paymentHistoryBody');
            tbody.innerHTML = '';
            paymentHistory.forEach(payment => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${getMonthName(payment.bulan)} ${payment.tahun}</td>
                    <td>${payment.tglBayar || '-'}</td>
                    <td>Rp ${formatNumber(payment.jumlah)}</td>
                    <td>
                        <span class="badge ${payment.status === 'lunas' ? 'bg-success' : 'bg-danger'}">
                            ${payment.status === 'lunas' ? 'Lunas' : 'Belum Bayar'}
                        </span>
                    </td>
                    <td>
                        ${payment.bukti ? `<a href="#" class="view-bukti" data-bukti="${payment.bukti}">Lihat</a>` : '-'}
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            // Event listener untuk melihat bukti transfer
            document.querySelectorAll('.view-bukti').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const bukti = this.getAttribute('data-bukti');
                    viewBuktiTransfer(bukti);
                });
            });
        }
        
        // Fungsi untuk memuat halaman bayar (pelanggan only)
        function loadBayar(contentArea) {
            contentArea.innerHTML = `
                <h4 class="mb-4">Pembayaran Tagihan WiFi</h4>
                
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-body">
                                <form id="paymentForm">
                                    <div class="mb-3">
                                        <label for="paymentCustomerId" class="form-label">ID Pelanggan</label>
                                        <input type="text" class="form-control" id="paymentCustomerId" value="PLG-001" readonly>
                                    </div>
                                    <div class="mb-3">
                                        <label for="paymentCustomerName" class="form-label">Nama Pelanggan</label>
                                        <input type="text" class="form-control" id="paymentCustomerName" value="Budi Santoso" readonly>
                                    </div>
                                    <div class="mb-3">
                                        <label for="paymentPackage" class="form-label">Paket Berlangganan</label>
                                        <input type="text" class="form-control" id="paymentPackage" value="Paket 10 Mbps - Rp 350.000/bulan" readonly>
                                    </div>
                                    <div class="mb-3">
                                        <label for="paymentMonth" class="form-label">Bulan Pembayaran</label>
                                        <select class="form-select" id="paymentMonth" required>
                                            <option value="">Pilih Bulan</option>
                                            <option value="8">Agustus 2023</option>
                                            <option value="9">September 2023</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="paymentAmount" class="form-label">Jumlah Pembayaran</label>
                                        <input type="text" class="form-control" id="paymentAmount" value="350000" readonly>
                                    </div>
                                    <div class="mb-3">
                                        <label for="paymentProof" class="form-label">Upload Bukti Transfer</label>
                                        <input type="file" class="form-control" id="paymentProof" accept="image/*,.pdf" required>
                                        <div class="form-text">Format: JPG, PNG, atau PDF (maks. 2MB)</div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="paymentDate" class="form-label">Tanggal Transfer</label>
                                        <input type="date" class="form-control" id="paymentDate" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="paymentAccount" class="form-label">Rekening Tujuan</label>
                                        <select class="form-select" id="paymentAccount" required>
                                            <option value="">Pilih Bank Tujuan</option>
                                            <option value="BCA">BCA - 1234567890 (PT WiFi Maju)</option>
                                            <option value="BRI">BRI - 0987654321 (PT WiFi Maju)</option>
                                        </select>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">Kirim Pembayaran</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Event listener untuk form pembayaran
            document.getElementById('paymentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                processPayment();
            });
        }
        
        // Fungsi untuk memproses pembayaran
        function processPayment() {
            // Implementasi pengiriman data pembayaran ke Google Spreadsheet
            alert('Pembayaran berhasil dikirim! Menunggu konfirmasi admin.');
            loadContent('statusPembayaran');
        }
        
        // Fungsi untuk login
        function login(username, password) {
            // Ini adalah contoh, dalam implementasi nyata Anda akan memanggil Google Apps Script
            // Untuk memverifikasi login dengan data di spreadsheet
            
            // Simulasi login
            if (username === 'admin' && password === 'admin123') {
                currentUser = {
                    username: 'admin',
                    role: 'admin'
                };
            } else if (username === 'kasir1' && password === 'kasir123') {
                currentUser = {
                    username: 'kasir1',
                    role: 'kasir'
                };
            } else if (username === 'pelanggan1' && password === 'pelanggan123') {
                currentUser = {
                    username: 'pelanggan1',
                    role: 'pelanggan',
                    idPelanggan: 'PLG-001'
                };
            } else {
                alert('Username atau password salah!');
                return;
            }
            
            loadContentBasedOnRole();
        }
        
        // Fungsi untuk logout
        function logout() {
            currentUser = null;
            loadContentBasedOnRole();
        }
        
        // Fungsi utilitas untuk memformat angka
        function formatNumber(num) {
            return parseInt(num).toLocaleString('id-ID');
        }
        
        // Fungsi utilitas untuk mendapatkan nama bulan
        function getMonthName(monthNumber) {
            const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 
                          'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
            return months[parseInt(monthNumber) - 1] || '';
        }
        
        // Event listener untuk form login
        document.getElementById('loginFormElement').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            login(username, password);
        });
        
        // Event listener untuk tombol logout
        document.getElementById('logoutBtn').addEventListener('click', logout);
        
        // Inisialisasi
        loadContentBasedOnRole();
    </script>
</body>
</html>
